<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="UTF-8">
<title>CellarCount ‚Äì Vinlager</title>
<style>
body{font-family:Arial;margin:20px}
table{border-collapse:collapse;width:100%}
th,td{border:1px solid #ccc;padding:6px;text-align:left}
th{background:#eee}
label{display:block;margin-top:10px}
button{margin-top:10px;padding:6px}
.total{margin-top:15px;font-weight:bold}
</style>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>
<body>

<h1>üç∑ CellarCount</h1>

<label>Importer CSV ( ; )
<input type="file" id="file"></label>
<button onclick="importCSV()">Importer</button>

<table>
<thead>
<tr>
<th>Navn</th><th>Type</th><th>Land</th><th>Reol</th><th>Hylde</th><th>Antal</th><th>Pris</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

<div class="total" id="total"></div>

<h2>Labels</h2>
<div id="labels"></div>

<script>
let wines = JSON.parse(localStorage.getItem("wines")||"[]");

function save(){localStorage.setItem("wines",JSON.stringify(wines));}

function render(){
 const tb=document.getElementById("rows");
 tb.innerHTML="";
 let sum=0;
 wines.forEach(w=>{
  sum+=w.price*w.quantity;
  tb.innerHTML+=`<tr>
  <td>${w.name}</td><td>${w.category}</td><td>${w.country}</td>
  <td>${w.reol}</td><td>${w.hylde}</td>
  <td>${w.quantity}</td><td>${w.price.toFixed(2)}</td></tr>`;
 });
 document.getElementById("total").innerText="Samlet lagerv√¶rdi: "+sum.toFixed(2)+" kr.";
 renderLabels();
}

function renderLabels(){
 const d=document.getElementById("labels");
 d.innerHTML="";
 wines.forEach(w=>{
  const c=document.createElement("canvas");
  QRCode.toCanvas(c,w.vinId);
  d.appendChild(document.createTextNode(w.name+" ‚Äì Reol "+w.reol+" Hylde "+w.hylde));
  d.appendChild(document.createElement("br"));
  d.appendChild(c);
  d.appendChild(document.createElement("hr"));
 });
}

function importCSV(){
 const f=document.getElementById("file").files[0];
 if(!f)return;
 const r=new FileReader();
 r.onload=e=>{
  const lines=e.target.result.split(/\r?\n/).filter(l=>l.trim());
  const h=lines.shift().split(";");
  wines=[];
  lines.forEach(l=>{
   const c=l.split(";");
   const o={};
   h.forEach((k,i)=>o[k]=c[i]);
   o.quantity=Number(o.quantity);
   o.price=Number(o.price);
   o.vinId=o.vinId||crypto.randomUUID();
   wines.push(o);
  });
  save();render();
  alert("Import f√¶rdig: "+wines.length+" vine");
 };
 r.readAsText(f,"UTF-8");
}

render();
</script>
</body>
</html>
